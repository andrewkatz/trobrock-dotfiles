#!/bin/bash

# Use the same AWS profile and endpoint as restore-from-s3
export AWS_PROFILE=minio
export AWS_ENDPOINT_URL_S3=http://192.168.1.180:9000

echo "Listing available backups in s3://code-backups/..."
echo "------------------------------------------------"

# List all objects in the bucket and format output
aws s3 ls s3://code-backups/ | grep ".tar.gz" | awk '{print $4}' | sed 's/\.tar\.gz$//' | sort

# Check if the command was successful
if [ $? -ne 0 ]; then
  echo "Error: Failed to list backups from S3"
  exit 1
fi

echo "------------------------------------------------"
echo "To restore a backup, run: ./restore-from-s3 <directory_name>"